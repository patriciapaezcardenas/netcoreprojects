@model IEnumerable<WebProject.Models.AccountType>

@{
    ViewData["Title"] = "Tipos de Cuenta";
}
<h2>@ViewData["Title"]</h2>
<h4>Se refiere a como agrupar cuentas, como Préstamos, Tarjetas de Crédito,etc.</h4>
<a class="btn btn-primary mb-3" asp-controller="AccountType" asp-action="Create">Nuevo</a>
<table class="table" >
    <thead>
        <th>Id</th>
        <th>Name</th>
        <th>Order</th>
        <th>User</th>
        <th>Actions</th>
    </thead>
    <tbody id="reordenable">
        @if (Model != null && Model.Any())
        {
            foreach (var item in Model)
            {
                <tr>
                    <input type="hidden" value="@item.Id" class="ids"/>
                    <td>@item.Id</td>
                    <td>@item.Name</td>
                    <td>@item.Order</td>
                    <td>@item.UserId</td>
                    <td>
                        <a class="btn btn-primary" asp-action="Edit" asp-route-id="@item.Id">Editar</a> |
                        <a class="btn btn-danger" asp-action="Delete" asp-route-id="@item.Id">Eliminar</a>
                    </td>
                </tr>
            }
        }
    </tbody>
</table>

@section Scripts {
    <script>
    const urlOrdenar = '@Url.Action("Order")';

  $(function(){
    $('#reordenable').sortable({
        stop: function(e, ui){
            var ids = getIds();
            console.log(ids);            
            sendOrderToServer(ids);
        }
    });
  })

    function getIds(){
        var ids = $('.ids').map(function()
        {
            return $(this).val();
        })
        .get();
        return ids;
    }

     function sendOrderToServer(ids) {   
        console.log(JSON.stringify(ids));
        $.ajax({
            url: urlOrdenar,
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(ids),
            success: function(result) {
                console.log('Order updated successfully');
            },
            error: function(error) {
                console.error('Error updating order', error);
            }
        });
    }
 </script>
}